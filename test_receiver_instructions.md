# GDL-90 接收器使用说明

## 📡 接收器功能

`gdl90_receiver.py` 是一个完整的GDL-90消息接收器和解码器，用于测试和验证X-Plane发送的Traffic Report消息。

## 🚀 快速开始

### 基本使用

```bash
# 使用默认端口4000监听
python gdl90_receiver.py

# 使用指定端口
python gdl90_receiver.py -p 5000
```

### 测试步骤

1. **启动接收器** (在一个终端窗口):
   ```bash
   python gdl90_receiver.py
   ```

2. **启动X-Plane发送器** (在另一个终端窗口):
   ```bash
   python main.py --traffic
   ```

3. **观察输出**: 接收器将显示所有收到的GDL-90消息

## 📋 支持的消息类型

- **0x00 - Heartbeat** (心跳消息)
- **0x0A - Ownship Report** (自机位置报告)
- **0x14 - Traffic Report** (交通目标报告) ⭐

## 🔧 命令行选项

```bash
# 基本选项
-p, --port          指定监听端口 (默认: 4000)

# 过滤选项
--no-heartbeat      不显示心跳消息
--no-ownship        不显示自机位置报告
--traffic-only      只显示交通报告消息
--no-errors         不显示错误消息

# 使用示例
python gdl90_receiver.py --traffic-only  # 专注于交通报告
python gdl90_receiver.py --no-heartbeat  # 减少心跳消息干扰
```

## 📊 显示信息

### Traffic Report 显示内容:

```
[14:30:25.123] 📨 从 10.16.25.146:54321
📋 消息类型: Traffic Report
🏷️  ICAO地址: 0x100001
🌍 位置: LAT=37.621311°, LON=-122.378968°
📏 高度: 2500ft
🚀 地速: 150 kts
⬆️  垂直速度: 800 fpm
🧭 航向: 090.0°
📻 呼号: 'UAL123  '
✈️  发射器类别: 1
📡 导航完整性: 11, 精度: 10
```

### 统计信息 (每30秒):

```
📈 统计信息 [14:30:55]:
   总消息数: 245
   心跳: 60
   自机报告: 120
   交通报告: 65
   CRC错误: 0
```

## 🔍 调试功能

### 错误显示
- **CRC校验错误**: 显示原始十六进制数据
- **消息格式错误**: 显示详细错误信息
- **未知消息类型**: 显示消息ID和原始数据

### 原始数据查看
错误消息会显示原始十六进制数据，便于调试:
```
❌ 错误: CRC校验失败
🔍 原始数据: 7e14010000ab...
📏 长度: 34 字节
```

## 🧪 测试建议

### 1. 基础连通性测试
```bash
# 只监听交通报告
python gdl90_receiver.py --traffic-only
```

### 2. 完整功能测试  
```bash
# 显示所有消息类型
python gdl90_receiver.py
```

### 3. 高频测试
```bash
# 不显示心跳，减少噪音
python gdl90_receiver.py --no-heartbeat
```

## 💡 使用技巧

1. **端口冲突**: 如果端口4000被占用，使用 `-p` 指定其他端口
2. **消息过多**: 使用过滤选项减少显示内容  
3. **调试模式**: 保留错误显示来发现问题
4. **长期监控**: 统计信息帮助了解消息频率

## 🔧 故障排除

### 问题: 收不到消息
- 检查端口是否正确 (默认4000)
- 确认发送器正在运行
- 检查防火墙设置

### 问题: CRC错误
- 发送器编码可能有问题
- 网络传输可能有问题
- 查看原始十六进制数据进行调试

### 问题: 消息格式错误
- 检查GDL-90消息帧结构 (0x7E开头结尾)
- 验证转义字符处理
- 查看消息长度是否正确

## 📝 数据验证要点

接收到Traffic Report时，重点检查:

1. **ICAO地址**: 应该是唯一的 (0x100001-0x10003F)
2. **位置数据**: 纬度/经度应该合理
3. **高度数据**: 转换是否正确 (25ft增量)
4. **速度数据**: 地速和垂直速度范围
5. **呼号**: 应该显示正确的aircraft标识
6. **CRC校验**: 确保数据完整性

使用这个接收器，你可以完全验证X-Plane发送的Traffic Report是否符合GDL-90标准！
